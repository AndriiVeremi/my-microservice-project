# DevOps CI/CD навчальний проєкт

Цей репозиторій містить інфраструктурний код та налаштування для розгортання веб-додатку Django в Kubernetes. Проєкт демонструє повний цикл CI/CD, включаючи створення інфраструктури за допомогою Terraform, збірку Docker-образів у Jenkins та безперервне розгортання за допомогою Argo CD.

## Архітектура

Проєкт складається з таких компонентів:

-   **Terraform**: для створення базової інфраструктури в AWS (VPC, EKS, ECR, S3, DynamoDB).
-   **Docker**: для контейнеризації Django-додатку.
-   **Jenkins**: для автоматизації збірки та тестування.
-   **Helm**: для пакування Kubernetes-додатку.
-   **Argo CD**: для безперервного розгортання в Kubernetes.

## Покрокова інструкція з розгортання

### Крок 1: Створення інфраструктури за допомогою Terraform

На цьому етапі ми створюємо всю необхідну інфраструктуру в AWS.

**Дії:**

1.  Перейдіть до директорії `lesson-5`:
    ```bash
    cd lesson-5
    ```

2.  Ініціалізуйте Terraform. Ця команда завантажить необхідні провайдери та модулі.
    ```bash
    terraform init
    ```

3.  Створіть план виконання. Ви побачите, які ресурси Terraform планує створити.
    ```bash
    terraform plan
    ```

4.  Застосуйте зміни для створення інфраструктури.
    ```bash
    terraform apply --auto-approve
    ```

**Перевірка:**

-   **Перевірка в AWS Console:**
    -   Перейдіть до консолі AWS.
    -   Переконайтеся, що створено новий VPC, EKS-кластер, ECR-репозиторій, S3-бакет та таблицю DynamoDB.
-   **Перевірка за допомогою AWS CLI:**
    ```bash
    # Перевірка EKS-кластера
    aws eks --region eu-north-1 describe-cluster --name <YOUR_CLUSTER_NAME>

    # Перевірка ECR-репозиторію
    aws ecr --region eu-north-1 describe-repositories --repository-names <YOUR_REPO_NAME>
    ```
    (Замініть `<YOUR_CLUSTER_NAME>` та `<YOUR_REPO_NAME>` на реальні імена з ваших Terraform-змінних).

### Крок 2: Налаштування Jenkins та Argo CD

На цьому етапі ми розгортаємо Jenkins та Argo CD у наш EKS-кластер.

**Дії:**

1.  Terraform автоматично розгорне Jenkins та Argo CD за допомогою Helm-чартів, які вказані в модулях `jenkins` та `argo_cd`.

**Перевірка:**

-   **Перевірка в Kubernetes:**
    ```bash
    # Перевірка, чи запущені поди Jenkins та Argo CD
    kubectl get pods -n jenkins
    kubectl get pods -n argocd
    ```
-   **Доступ до Jenkins та Argo CD:**
    -   Знайдіть інструкції для доступу до Jenkins та Argo CD у вихідних даних Terraform (`terraform output`).
    -   Відкрийте їх у браузері та переконайтеся, що вони працюють.

### Крок 3: Збірка Docker-образу в Jenkins

На цьому етапі Jenkins автоматично збирає Docker-образ нашого Django-додатку та завантажує його в ECR.

**Дії:**

1.  Запустіть Jenkins-пайплайн (зазвичай він запускається автоматично після коміту в репозиторій).

**Перевірка:**

-   **Перевірка в Jenkins:**
    -   Відкрийте Jenkins.
    -   Перейдіть до пайплайну `django-app-pipeline`.
    -   Переконайтеся, що остання збірка успішно завершилася. Перегляньте логи, щоб побачити кроки збірки та завантаження в ECR.
-   **Перевірка в ECR:**
    -   Перейдіть до вашого ECR-репозиторію в AWS Console.
    -   Переконайтеся, що з'явився новий Docker-образ з останнім тегом.

### Крок 4: Розгортання в Kubernetes за допомогою Argo CD

На цьому етапі Argo CD автоматично розгортає наш додаток у Kubernetes, використовуючи оновлений Docker-образ.

**Дії:**

1.  Argo CD автоматично виявить зміни в репозиторії (новий Docker-образ) і запустить процес синхронізації.

**Перевірка:**

-   **Перевірка в Argo CD:**
    -   Відкрийте Argo CD.
    -   Знайдіть додаток `django-chart`.
    -   Переконайтеся, що його статус `Healthy` та `Synced`.
    -   Натисніть на додаток, щоб побачити всі розгорнуті ресурси (Deployment, Service, Pods).
-   **Перевірка в Kubernetes:**
    ```bash
    # Перевірка, чи запущено под з Django-додатком
    kubectl get pods -n <YOUR_APP_NAMESPACE>

    # Перевірка логів додатку
    kubectl logs -f <YOUR_POD_NAME> -n <YOUR_APP_NAMESPACE>
    ```
-   **Доступ до додатку:**
    -   Знайдіть зовнішню IP-адресу або DNS-ім'я вашого сервісу (зазвичай LoadBalancer).
    -   Відкрийте цю адресу в браузері. Ви повинні побачити сторінку Django.